<html>

<head>
	<title>Project 5</title>
	<script type='text/javascript' src='js/knockout-3.3.0.js'></script>
	<script type='text/javascript' src='js/jquery-2.1.3.min.js'></script>
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBr9puVePcpzhyLxLfEph5-AXkvFtbxWe8">
	</script>

	<script type="text/javascript">

      function f(m){ console.log(  m)}

      $( document ).ready(  function(){

      	var map = new google.maps.Map(document.getElementById('map-canvas'), {center: new google.maps.LatLng(33.486305, -112.049339),zoom: 12 });

        var markers = [];
		var a = new google.maps.Marker({
	            position: new google.maps.LatLng(33.509853, -112.027171),
	            map: map,
	            title:"Biltmore", 
	            animation: google.maps.Animation.DROP	            
        	}); 
		// google.maps.event.addListener( a , 'click', function (){
		// 	infowindow.open( map, a );
		// });
		
		var b = new google.maps.Marker( { 
	        	position : new google.maps.LatLng(33.439610, -112.011336), 
	        	map : map, 
	          	title : "Sky Harbor International Airport"
      		}); 
		// google.maps.event.addListener( b , 'click', function (){
		// 	infowindow.open( map, b );
		// });


		
      	var c = new google.maps.Marker( { 
	        	position : new google.maps.LatLng(33.578376, -112.121843), 
	        	map : map, 
	          	title : "Metro Center Mall"
      		});
		// google.maps.event.addListener( c , 'click', function (){
		// 	infowindow.open( map, c );
		// });

      	
      	// 
      	// start of the knockout init code
      	//
      	function DecoratedMarker( info , ma , bText , mvm){
      		var self = this;
      		self.info = info;
      		self.bubbleText = bText;
      		self.mvm = mvm;
      		self.infowindow = new google.maps.InfoWindow({ content : bText })
      		self.m = ko.observable( ma );
      		/*
      			This function is called when one of the markers on the map is clicked
      		*/
      		google.maps.event.addListener( self.m() , 'click',  function(){  
      			window.mvm.closeAll();
      			self.infowindow.open( map, self.m() );  
      		}); 

      		/*
      			This function is called when one of the list items is clicked from list view
      		*/
      		self.selected = function(){     
      			mvm.closeAll();
      			self.infowindow.open(map,self.m());
      		}
      	}

      	function MarkerViewModel(){
      		var self = this;
      		self.markers = ko.observableArray( [
      				new DecoratedMarker( "the biltmore ..." , a , 'biltmore bubble', self),
      				new DecoratedMarker( "the airport ...." , b , 'airport bubble', self),
      				new DecoratedMarker( "the mall " , c , 'mall bubble ', self),
      			]);

      		self.selectItem = function( item ){
      			item.selected();
      		}

      		self.closeAll = function( ){
      			for( var i = 0; i < self.markers().length; i++ ){
      				var m = self.markers()[i];
      				m.infowindow.close();
      			}
      		}
      	}

      	/*
      		Construct and store a ref to the MarkerViewModel, it is stored in the window object for global access. 
      		If I can find a better way to integrate google map markers with knockout this may not be needed
      	*/
      	var mvm = new MarkerViewModel();
      	window.mvm = mvm;
        ko.applyBindings( mvm );

      });
    </script>
</head>
<body>
		<table>
			<tr>
				<td><h1>Udacity Nanodegree Project 5</h1></td>
			</tr>
			<tr>
				<td>
			
					<form action="">
						<button type="button">Search</button>
						<input id="query"/>
					</form>
				</td>
			</tr>
		</table>	

	<div id="map-canvas"></div>

	<div id="list-view">
		<table>
			<tbody data-bind="foreach: markers()">
				<tr data-bind="click: $root.selectItem"><td data-bind="text: info"> .... </td></tr>
			</tbody>
		</table>
	</div>


</body>
</html>